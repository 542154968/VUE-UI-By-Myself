<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div data-v-27fbde70="" class="kie-detail-item">
      <div data-v-27fbde70="" class="txt_title" style="padding-top: 32px;">
        现病史:
      </div>
      <div data-v-27fbde70="" id="illnessHistory" class="selected-class">
        <span></span>患者于
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="8eaec80c-de0d-408d-8646-9f3e0b382fba"
            style="background-color: rgba(144, 147, 153, 0.6); position: relative; margin-left: 10px; margin-right: 10px;"
            ><span class="block-span1"></span>7天前<span
              class="icon-span1"
              style="background-color:#909399"
              >发病时间</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="958c1a5f-71d9-4b7e-a6c1-16bb73a03a3a"
            style="background-color:rgba(220,20,60,0.6);position: relative;"
            ><span class="block-span1"></span>受凉<span
              class="icon-span1"
              style="background-color:#DC143C"
              >诱因</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        后开始出现
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="2baf8e09-d25f-4aab-ba2f-860270c7ba17"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>咳嗽<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        、
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="84da1b14-1fe5-4cca-b090-d8d9a11bdfda"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>咳痰<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        ，伴
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="3521a8cb-950b-4a45-8200-a3117ef4d47d"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>鼻塞<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        、
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="866e3a2a-91ec-4931-a0c3-f4742e25915f"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>胸痛<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        ，当时未予重视，
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="99972033-4fc6-4aef-bd13-cf3e4458b7d0"
            style="background-color: rgba(144, 147, 153, 0.6); position: relative; margin-left: 10px; margin-right: 10px;"
            ><span class="block-span1"></span>1天前<span
              class="icon-span1"
              style="background-color:#909399"
              >发病时间</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        出现
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="8c3613e1-23ed-45a6-b3d9-358451ebe2f7"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>发热<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        ，
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="ab3d3a36-93f9-4c7d-98b9-864546b20d8b"
            style="background-color:rgba(153,204,51,0.6);position: relative;"
            ><span class="block-span1"></span>最高温度39℃<span
              class="icon-span1"
              style="background-color:#99CC33"
              >体温</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        ，
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="fcb3d19f-ffa0-417b-b805-455de2b8f6a3"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>胸痛加重<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        ，伴有
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="c359b673-76e8-41d1-8ec6-62063356b60b"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>畏寒<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        。 ，伴
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="3521a8cb-950b-4a45-8200-a3117ef4d47d"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>鼻塞<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        ，伴
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="3521a8cb-950b-4a45-8200-a3117ef4d47d"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>鼻塞<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="ffa481a4-9981-4abe-bc8c-99e1e69e8295"
            style="background-color:rgba(218,112,214,0.6);position: relative;"
            ><span class="block-span1"></span>无明显恶心、呕吐<span
              class="icon-span1"
              style="background-color:#DA70D6"
              >非异常发现</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        。发病来，
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="bfac49cc-3075-4882-920a-9603131e848d"
            style="background-color:rgba(255,182,193,0.6);position: relative;"
            ><span class="block-span1"></span>胃纳欠佳<span
              class="icon-span1"
              style="background-color:#FFB6C1"
              >症状</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        ，
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="f8f7b1b2-5400-46d8-b060-c288957e31dc"
            style="background-color: rgba(218, 112, 214, 0.6); position: relative; margin-left: 10px; margin-right: 10px;"
            ><span class="block-span1"></span>二便正常<span
              class="icon-span1"
              style="background-color:#DA70D6"
              >非异常发现</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        ，
        <div class="inline-block-contain">
          <span
            class="cc"
            data-id="de1a99bc-72fc-4e18-926f-5552cd95324e"
            style="background-color:rgba(218,112,214,0.6);position: relative;"
            ><span class="block-span1"></span>体重无明显变化<span
              class="icon-span1"
              style="background-color:#DA70D6"
              >非异常发现</span
            ><span class="demo demo1"></span
          ></span>
        </div>
        。
      </div>
    </div>

    <script>
      function getNodeStartAndEndNode(targetEl, startText, allText) {
        
        const nodeRangeArr = []
        const nodeArr = Array.from(targetEl.childNodes);
        
        function getChildNodeIndex(str) {
          const starIndex = [];
          nodeArr.forEach((v, index) => {
            const childText = getNodeText(v);

            if (childText && childText.indexOf(str) > -1) {
              starIndex.push(index);
            }
          });

          return starIndex;
        }

        function getNodeText(node) {
          const str = node.nodeType === 3 ? node.nodeValue : node.innerText;
          return typeof str === "string" ? str.replace(/\s|\n/g, "") : "";
        }

        // NodeIndex shichildnodelist 中的index
        // index 是startIndexarr中的index
        function getEndNode(nodeIndex, index, allText) {
          const node = nodeArr[nodeIndex];
          let brotherNode = node.nextSibling;
          let str = startText;
          let endNode = null;
          // 如果兄弟节点存在 并且不是终止符号
          while (
            brotherNode &&
            !startIndexArr.includes(brotherNode) &&
            str !== allText
          ) {
            str += getNodeText(brotherNode);
            if (str === allText) {
              endNode = brotherNode;
              break;
            }
            brotherNode = brotherNode.nextSibling;
          }
           endNode && nodeRangeArr.push({startNode: node, endNode:endNode})
          // const startOutHTML = node.outerHTML
          // console.log(node, brotherNode, '---')
        }

        // 起始文字
        const startIndexArr = getChildNodeIndex(startText);

        startIndexArr.forEach((v, index) => {
          // 全句子
          getEndNode(v, index, allText);
        });

        return nodeRangeArr
      }

      console.log(getNodeStartAndEndNode(
        document.querySelector(".selected-class"),
        "，伴",
        "，伴鼻塞症状"
      ));
    </script>
  </body>
</html>
